import e,{useRef as t,useState as n,useEffect as r,forwardRef as o,useImperativeHandle as l,useCallback as i,useMemo as c,useLayoutEffect as a}from"react";import{HtmlUtils as u}from"@delpi/common";import s from"perfect-scrollbar";var d=function(){return d=Object.assign||function(e){for(var t,n=1,r=arguments.length;n<r;n++)for(var o in t=arguments[n])Object.prototype.hasOwnProperty.call(t,o)&&(e[o]=t[o]);return e},d.apply(this,arguments)};function v(e,t,n,r){return new(n||(n=Promise))(function(o,l){function i(e){try{a(r.next(e))}catch(e){l(e)}}function c(e){try{a(r.throw(e))}catch(e){l(e)}}function a(e){var t;e.done?o(e.value):(t=e.value,t instanceof n?t:new n(function(e){e(t)})).then(i,c)}a((r=r.apply(e,t||[])).next())})}function f(e,t){var n,r,o,l={label:0,sent:function(){if(1&o[0])throw o[1];return o[1]},trys:[],ops:[]},i=Object.create(("function"==typeof Iterator?Iterator:Object).prototype);return i.next=c(0),i.throw=c(1),i.return=c(2),"function"==typeof Symbol&&(i[Symbol.iterator]=function(){return this}),i;function c(c){return function(a){return function(c){if(n)throw new TypeError("Generator is already executing.");for(;i&&(i=0,c[0]&&(l=0)),l;)try{if(n=1,r&&(o=2&c[0]?r.return:c[0]?r.throw||((o=r.return)&&o.call(r),0):r.next)&&!(o=o.call(r,c[1])).done)return o;switch(r=0,o&&(c=[2&c[0],o.value]),c[0]){case 0:case 1:o=c;break;case 4:return l.label++,{value:c[1],done:!1};case 5:l.label++,r=c[1],c=[0];continue;case 7:c=l.ops.pop(),l.trys.pop();continue;default:if(!(o=l.trys,(o=o.length>0&&o[o.length-1])||6!==c[0]&&2!==c[0])){l=0;continue}if(3===c[0]&&(!o||c[1]>o[0]&&c[1]<o[3])){l.label=c[1];break}if(6===c[0]&&l.label<o[1]){l.label=o[1],o=c;break}if(o&&l.label<o[2]){l.label=o[2],l.ops.push(c);break}o[2]&&l.ops.pop(),l.trys.pop();continue}c=t.call(e,l)}catch(e){c=[6,e],r=0}finally{n=o=0}if(5&c[0])throw c[1];return{value:c[0]?c[1]:void 0,done:!0}}([c,a])}}}"function"==typeof SuppressedError&&SuppressedError;var h=function(e,t,n,r){if(void 0===r&&(r=.95),!t.raf){var o=function(){var l=t.vx,i=t.vy;if(Math.abs(l)<.1&&Math.abs(i)<.1)return t.raf=null,void(null==n||n.forEach(function(t){var n;return null===(n=t.onScrollStop)||void 0===n?void 0:n.call(t,e)}));e.scrollLeft+=Math.sign(l)*Math.min(Math.abs(l),50),e.scrollTop+=Math.sign(i)*Math.min(Math.abs(i),50),t.vx*=r,t.vy*=r,null==n||n.forEach(function(t){var n;return null===(n=t.onScroll)||void 0===n?void 0:n.call(t,e)}),t.raf=requestAnimationFrame(o)};null==n||n.forEach(function(t){var n;return null===(n=t.onScrollStart)||void 0===n?void 0:n.call(t,e)}),t.raf=requestAnimationFrame(o)}},p=new WeakMap,m=function(e){return.5-Math.cos(e*Math.PI)/2},y=function(e,t,n){var r="y"===t?"ps--scrolling-y":"ps--scrolling-x";n?e.classList.add(r):e.classList.remove(r)},g=function(e,t,n){if(void 0===n&&(n={}),e){var r=n.duration,o=void 0===r?300:r,l=n.easing,i=void 0===l?m:l;p.has(e)&&(cancelAnimationFrame(p.get(e)),p.delete(e));var c=e.scrollTop,a=t-c;if(0!==a){var u=performance.now();y(e,"y",!0);var s=function(n){var r=n-u,l=Math.min(r/o,1),d=Math.max(0,Math.min(1,i(l)));if(l>0&&(e.scrollTop=c+a*d),l<1){var v=requestAnimationFrame(s);p.set(e,v)}else p.delete(e),e.scrollTop=t,y(e,"y",!1)},d=requestAnimationFrame(s);p.set(e,d)}else e.scrollTop=t}},b=function(e,t,n){if(void 0===n&&(n={}),e){var r=n.duration,o=void 0===r?300:r,l=n.easing,i=void 0===l?m:l;p.has(e)&&(cancelAnimationFrame(p.get(e)),p.delete(e));var c=e.scrollLeft,a=t-c;if(0!==a){var u=performance.now();y(e,"x",!0);var s=function(n){var r=n-u,l=Math.min(r/o,1),d=Math.max(0,Math.min(1,i(l)));if(l>0&&(e.scrollLeft=c+a*d),l<1){var v=requestAnimationFrame(s);p.set(e,v)}else p.delete(e),e.scrollLeft=t,y(e,"x",!1)},d=requestAnimationFrame(s);p.set(e,d)}else e.scrollLeft=t}},E=function(e,t){if(void 0===t&&(t={}),e){var n=e.scrollHeight-e.clientHeight;g(e,n,t)}},S=function(e,t){void 0===t&&(t={}),e&&g(e,0,t)},x=function(e,t){for(var n=[],r=2;r<arguments.length;r++)n[r-2]=arguments[r];null==e||e.forEach(function(e){var r=e[t];r&&r.apply(void 0,n)})},w=function(e,t,n,r,o,l,i){void 0===o&&(o=!1),void 0===l&&(l=.95);var c=function(){var t;return null===(t=e.current)||void 0===t?void 0:t.element},a=null,u=function(){r&&(r.vx=0,r.vy=0)},s=function(e,a,s,d,v){void 0===s&&(s=null!=t?t:300),void 0===d&&(d=null!=n?n:function(e){return e}),void 0===v&&(v=!1);var f=c();f&&r&&(v?(void 0!==e&&(r.vx=e-f.scrollLeft),void 0!==a&&(r.vy=a-f.scrollTop)):u(),void 0!==e&&b(f,e,{duration:s,easing:d}),void 0!==a&&g(f,a,{duration:s,easing:d}),x(i,"onScroll",f),o&&v&&h(f,r,i,l),void 0!==a&&(a<=0&&x(i,"onReachTop"),a+f.clientHeight>=f.scrollHeight&&x(i,"onReachBottom"),a+f.clientHeight>=.9*f.scrollHeight&&x(i,"onReachThreshold",90)),void 0!==e&&(e<=0&&x(i,"onReachLeft"),e+f.clientWidth>=f.scrollWidth&&x(i,"onReachRight")))},d={update:function(){var t;return null===(t=e.current)||void 0===t?void 0:t.update()},destroy:function(){var t;null===(t=e.current)||void 0===t||t.destroy(),x(i,"onDestroy"),a&&c()&&c().removeEventListener("scroll",a),u()},getScrollbar:function(){var t;return null!==(t=e.current)&&void 0!==t?t:null},getScrollElement:function(){var e;return null!==(e=c())&&void 0!==e?e:null},resetMomentum:u,scrollToX:function(e,t,n){return s(e,void 0,t,n)},scrollToY:function(e,t,n){return s(void 0,e,t,n)},scrollToTop:function(e,t){return s(void 0,0,e,t)},scrollToBottom:function(e,t){var n=c();n&&s(void 0,n.scrollHeight,e,t)},scrollToLeft:function(e,t){return s(0,void 0,e,t)},scrollToRight:function(e,t){var n=c();n&&s(n.scrollWidth,void 0,e,t)},scrollToIndex:function(e,t,n){var r=c();if(r){var o=r.children[e];o&&s(void 0,o.offsetTop,t,n)}},scrollToElement:function(e,t,n){c()&&e&&s(void 0,e.offsetTop,t,n)},scrollToPercent:function(e,r,o,l){void 0===o&&(o=null!=t?t:500),void 0===l&&(l=null!=n?n:function(e){return e});var i=c();if(i){var a=void 0!==e?(i.scrollHeight-i.clientHeight)*e:void 0,u=void 0!==r?(i.scrollWidth-i.clientWidth)*r:void 0;s(u,a,o,l)}}},v=c();return v&&(x(i,"onInit",d,v),a=function(){x(i,"onScroll",v)},v.addEventListener("scroll",a)),d},T={"ps-scroll-y":"onScrollY","ps-scroll-x":"onScrollX","ps-scroll-up":"onScrollUp","ps-scroll-down":"onScrollDown","ps-scroll-left":"onScrollLeft","ps-scroll-right":"onScrollRight","ps-y-reach-start":"onYReachStart","ps-y-reach-end":"onYReachEnd","ps-x-reach-start":"onXReachStart","ps-x-reach-end":"onXReachEnd"},L=function(e){var t=e.height,n=e.maxHeight,r=e.width,o=e.maxWidth,l=function(e){return void 0===e?void 0:"number"==typeof e?"".concat(e,"px"):e};return d(d(d(d({},t?{height:l(t)}:{}),n?{maxHeight:l(n)}:{}),r?{width:l(r)}:{}),o?{maxWidth:l(o)}:{})},H=function(e,t){var n={};return t?(Object.entries(T).forEach(function(r){var o=r[0],l=r[1],i=e[l];i&&(n[o]=function(e){return i(e)},t.addEventListener(o,n[o]))}),n):n},M=function(e,t){void 0===e&&(e={}),Object.entries(e).forEach(function(e){var n=e[0],r=e[1];t.removeEventListener(n,r)})},I=function(e,t,n){var r;if(!e.current)return{el:null};if(n){var o=e.current.querySelector("table"),l=null!==(r=null==o?void 0:o.querySelector("tbody"))&&void 0!==r?r:null;if(l)return Object.entries(t).forEach(function(e){var t=e[0],n=e[1];l.style[t]=n}),{table:null!=o?o:void 0,el:l}}return{el:e.current}},A=function(e,t){return Array.from(e).filter(function(e){return!t.includes(e)})},F=function(e){return void 0===e&&(e=[]),e.reduce(function(e,t){return e+t.clientHeight},0)},R=function(e,t,n){var r=(null!=n?n:u.findFirstLevel(e,t)).filter(u.isVisible);return r.length?r[r.length-1]:null};function k(e,o){var l,i=e.options,c=e.always,a=e.wheelStop,u=e.injectTable,v=e.effectData,f=e.autoScrollBottom,p=e.autoScrollToNewItem,m=e.preserveScroll,y=e.scrollSaveKey,b=e.disableKeyboard,E=e.scrollDuration,S=e.scrollEasing,x=e.plugins,T=void 0===x?[]:x,A=e.inertia,F=void 0===A||A,R=e.inertiaFriction,k=e.scrollLock,D=e.onScroll,C=e.onScrollStart,q=e.onScrollStop,z=e.onScrollDirectionChange,O=e.onUserScroll,P=e.onReachTop,j=e.onReachBottom,N=e.onReachLeft,Y=e.onReachRight,W=e.onReachStart,B=e.onReachEnd,U=e.onReachThreshold,X=function(e,t){var n={};for(var r in e)Object.prototype.hasOwnProperty.call(e,r)&&t.indexOf(r)<0&&(n[r]=e[r]);if(null!=e&&"function"==typeof Object.getOwnPropertySymbols){var o=0;for(r=Object.getOwnPropertySymbols(e);o<r.length;o++)t.indexOf(r[o])<0&&Object.prototype.propertyIsEnumerable.call(e,r[o])&&(n[r[o]]=e[r[o]])}return n}(e,["options","always","wheelStop","injectTable","effectData","autoScrollBottom","autoScrollToNewItem","preserveScroll","scrollSaveKey","disableKeyboard","scrollDuration","scrollEasing","plugins","inertia","inertiaFriction","scrollLock","onScroll","onScrollStart","onScrollStop","onScrollDirectionChange","onUserScroll","onReachTop","onReachBottom","onReachLeft","onReachRight","onReachStart","onReachEnd","onReachThreshold"]),K=t(null),_=t(null),G=t({x:0,y:0}),J=t(null),V=t({x:0,y:0}),Q=t({vx:0,vy:0,raf:null}),Z=t(null),$=n(!1),ee=$[0],te=$[1],ne=L(X),re=null!==(l=null==i?void 0:i.wheelPropagation)&&void 0!==l?l:a;return r(function(){if(_.current){var e=I(_,ne,u),t=e.table,n=e.el,r=d(d({},i||{}),{wheelPropagation:re});t&&(K.current=n,r.suppressScrollX=!0,t.classList.add("list-dk-scroll-view","perfect-table"),c&&(null==n||n.classList.add("scroll-always")),re&&(null==n||n.classList.add("scroll-wheel-stop"))),Z.current=new s(n,r),k&&n&&(n.style.overflow="hidden");var l=H(X,n);if(y){var a=sessionStorage.getItem(y);if(a){var v=JSON.parse(a),p=v.x,g=v.y;n.scrollTop=g,n.scrollLeft=p}}m&&(n.scrollTop=G.current.y,n.scrollLeft=G.current.x),f&&(n.scrollTop=n.scrollHeight);var x=function(e){if(b){["ArrowUp","ArrowDown","ArrowLeft","ArrowRight","PageUp","PageDown","Home","End"," "].includes(e.key)&&e.preventDefault()}};b&&window.addEventListener("keydown",x);var L={x:0,y:0},A=function(e){var t=n,r=t.scrollLeft,o=t.scrollTop,l="wheel"===e.type||"touchmove"===e.type;null==D||D({x:r,y:o}),F&&l&&(Q.current.vx=r-V.current.x,Q.current.vy=o-V.current.y,h(t,Q.current,T,R)),C&&(J.current?clearTimeout(J.current):C()),q&&(J.current&&clearTimeout(J.current),J.current=window.setTimeout(function(){J.current=null,q()},150)),r-L.x===0&&o-L.y===0||!z||(z({x:r-L.x,y:o-L.y}),L={x:r,y:o}),null==O||O({x:r,y:o});var i=.9*t.scrollHeight;if(U&&o+t.clientHeight>=i&&U(90),j&&o+t.clientHeight>=t.scrollHeight&&j(),P&&o<=0&&P(),B&&o+t.clientHeight>=t.scrollHeight&&B(),W&&o<=0&&W(),Y&&r+t.clientWidth>=t.scrollWidth&&Y(),N&&r<=0&&N(),V.current={x:r,y:o},F&&n){var c=Q.current,a=c.vx,u=c.vy;(Math.abs(a)>.1||Math.abs(u)>.1)&&requestAnimationFrame(function(){n.scrollLeft+=a,n.scrollTop+=u,Q.current.vx*=null!=R?R:.95,Q.current.vy*=null!=R?R:.95})}};n.addEventListener("scroll",A),o&&(o.current=w(Z,E,S,Q.current,F,R,T));var $=new ResizeObserver(function(){var e;return null===(e=Z.current)||void 0===e?void 0:e.update()});return $.observe(n),window.addEventListener("resize",function(){var e;return null===(e=Z.current)||void 0===e?void 0:e.update()}),function(){var e;if(m&&Z.current){var t=Z.current.element;G.current={x:t.scrollLeft,y:t.scrollTop}}M(l,n),n.removeEventListener("scroll",A),$.disconnect(),window.removeEventListener("resize",function(){var e;return null===(e=Z.current)||void 0===e?void 0:e.update()}),b&&window.removeEventListener("keydown",x),null===(e=Z.current)||void 0===e||e.destroy(),Q.current.raf&&cancelAnimationFrame(Q.current.raf)}}},[_.current,v]),r(function(){if(Z.current&&_.current){var e=Z.current.element;Z.current.update(),p&&g(e,e.scrollHeight,{duration:E,easing:S})}},[v,e.children]),{refsTarget:_,hovering:ee,setHovering:te,dimension:ne,getApi:function(){return w(Z,E,S,Q.current,F,R,T)},plugins:T}}var D=o(function(t,n){var r,o,i=k(t,n&&"function"!=typeof n?n:void 0),c=i.refsTarget,a=i.hovering,s=i.setHovering,v=i.dimension,f=i.getApi,h=i.plugins;l(n,f);var p=u.joinClass("list-dk-scroll-view","perfect-list",t.className,t.autoHide&&!a?"scroll-hidden":void 0),m=u.joinClass("scroll-content",{"scroll-always":t.always},{"scroll-wheel-stop":null!==(o=null===(r=t.options)||void 0===r?void 0:r.wheelPropagation)&&void 0!==o?o:t.wheelStop}),y=function(t){return null==h?void 0:h.map(function(n,r){var o;if((null!==(o=n.mountPosition)&&void 0!==o?o:"outside")!==t)return null;if(n.render)return e.createElement("div",{key:r,className:"scrollbar-plugin ".concat(t)},n.render());if(n.renderDom){return e.createElement("div",{key:r,ref:function(e){if(e&&!e.firstChild){var t=n.renderDom();e.appendChild(t)}},className:"scrollbar-plugin ".concat(t)})}return null})};return e.createElement("div",{id:t.id,className:p,style:d(d({},t.style),t.injectTable?{}:v),onMouseEnter:function(){return s(!0)},onMouseLeave:function(){return s(!1)}},y("before"),e.createElement("div",{ref:c,className:m},t.children,y("inside")),y("outside"))});D.displayName="Scrollbar";var C=function(e){var t=void 0===e?{}:e,n=t.distance,r=void 0===n?80:n,o=t.duration,l=void 0===o?400:o,i=t.borderColor,c=void 0===i?"#40a9ff":i,a=t.borderWidth,u=void 0===a?1.5:a,s=t.borderDuration,d=void 0===s?250:s,v=null,f=null,h=0,p=!1,m=function(){if(v){h*=.8;var e=v.scrollHeight-v.clientHeight,t=h;v.scrollTop+h>e&&(t=e-v.scrollTop),v.scrollTop+h<0&&(t=-v.scrollTop),v.style.transform="translateY(".concat(t,"px)"),!p&&Math.abs(h)>0&&(v.style.border="".concat(u,"px solid ").concat(c),p=!0),Math.abs(h)>1?f=requestAnimationFrame(m):(v.style.transition="transform ".concat(l,"ms ease-out, border ").concat(d,"ms"),v.style.transform="translateY(0)",setTimeout(function(){v&&(v.style.transform="",v.style.transition="",v.style.border="",p=!1)},Math.max(l,d)),f=null,h=0)}};return{onInit:function(e,t){(v=t.firstElementChild)||console.warn("bounce plugin: wrapper not found")},onScroll:function(e){if(v){var t=e.scrollTop,n=v.scrollHeight,o=v.clientHeight,l=t-parseFloat(e.dataset.lastScroll||"0");t<=0&&l<0?h=Math.max(l,-r):t+o>=n&&l>0&&(h=Math.min(l,r)),0===h||f||m(),e.dataset.lastScroll=t.toString()}},onDestroy:function(){f&&cancelAnimationFrame(f),v&&(v.style.transform="",v.style.border=""),v=null,f=null,h=0,p=!1}}},q=function(e){var t=void 0===e?{}:e,n=t.distance,r=void 0===n?20:n,o=t.duration,l=void 0===o?300:o,i=null,c=null,a=0,u=function(e){if(i){var t=performance.now(),n=function(r){var o=Math.min((r-t)/l,1),a=Math.sin(o*Math.PI/2);i.style.transform="translateY(".concat(e*(1-a),"px)"),o<1?c=requestAnimationFrame(n):(i.style.transform="",c=null)};c=requestAnimationFrame(n)}};return{onInit:function(e,t){(i=t.firstElementChild)||console.warn("bounce plugin: wrapper not found"),a=t.scrollTop},onScroll:function(e){if(i){var t=e.scrollTop,n=e.scrollHeight,o=e.clientHeight,l=t-a;t<=0&&l<0?u(r):t+o>=n&&l>0&&u(-r),a=t}},onDestroy:function(){c&&cancelAnimationFrame(c),i&&(i.style.transform=""),i=null,c=null}}},z=function(e){var t=void 0===e?{}:e,n=t.gradientSize,r=void 0===n?30:n,o=t.gradientColor,l=void 0===o?"rgba(0,0,0,0.1)":o,i=t.zIndex,c=void 0===i?1e3:i,a=null,u=null,s=null,d=null,v=function(){if(a&&u&&s){var e=a.scrollTop,t=a.scrollHeight,n=a.clientHeight;u.style.opacity=e>0?"1":"0";var o=t-(e+n);s.style.opacity=o>1?"1":"0",s.style.top="".concat(e+n-r,"px"),d=null}};return{onInit:function(e,t){(a=t).style.position&&"static"!==a.style.position||(a.style.position="relative"),u=t.querySelector("[data-gradient-top]"),s=t.querySelector("[data-gradient-bottom]"),u||((u=document.createElement("div")).setAttribute("data-gradient-top","true"),Object.assign(u.style,{position:"absolute",top:"0",left:"0",width:"100%",height:"".concat(r,"px"),background:"linear-gradient(to bottom, ".concat(l,", transparent)"),pointerEvents:"none",transition:"opacity 0.3s",zIndex:c.toString()}),t.appendChild(u)),s||((s=document.createElement("div")).setAttribute("data-gradient-bottom","true"),Object.assign(s.style,{position:"absolute",left:"0",width:"100%",height:"".concat(r,"px"),background:"linear-gradient(to top, ".concat(l,", transparent)"),pointerEvents:"none",transition:"opacity 0.3s",zIndex:c.toString()}),t.appendChild(s)),v()},onScroll:function(){null===d&&(d=requestAnimationFrame(v))},onDestroy:function(){u&&u.remove(),s&&s.remove(),a=null,u=null,s=null,d&&cancelAnimationFrame(d),d=null}}},O=function(e){var t=void 0===e?{}:e,n=t.itemSelector,r=void 0===n?"li":n,o=t.highlightClass,l=void 0===o?"ps-scroll-highlight":o,i=null,c=null,a=null,u=function(){if(i){var e=i.scrollTop+i.clientHeight/2,t=Array.from(i.querySelectorAll(r));if(t.length){for(var n=t[0],o=Math.abs(t[0].offsetTop-e),a=0,u=t;a<u.length;a++){var s=u[a],d=Math.abs(s.offsetTop-e);d<o&&(o=d,n=s)}c&&c.classList.remove(l),n.classList.add(l),c=n}}};return{onInit:function(e,t){i=t,u()},onScroll:function(){a&&cancelAnimationFrame(a),a=requestAnimationFrame(u)},onDestroy:function(){c&&c.classList.remove(l),i=null,c=null,a&&cancelAnimationFrame(a),a=null}}},P=function(e){var t=void 0===e?{}:e,n=t.momentumRef,r=void 0===n?{vx:0,vy:0,raf:null}:n,o=t.friction,l=void 0===o?.95:o,i=null,c=function(e){r&&(Math.abs(r.vx)<.1&&Math.abs(r.vy)<.1?r.raf=null:(e.scrollLeft+=r.vx,e.scrollTop+=r.vy,r.vx*=l,r.vy*=l,r.raf=requestAnimationFrame(function(){return c(e)})))};return{onInit:function(e,t){r.raf||(i=requestAnimationFrame(function(){return c(t)}))},onScroll:function(e){var t,n,o=e.scrollLeft-(null!==(t=r.vx)&&void 0!==t?t:0),l=e.scrollTop-(null!==(n=r.vy)&&void 0!==n?n:0);r.vx=o,r.vy=l},onDestroy:function(){i&&cancelAnimationFrame(i)}}},j=function(t){var o=t.threshold,l=void 0===o?60:o,i=t.onLoadMore,c=t.onCompleted,a=t.loading,u=void 0===a?e.createElement(e.Fragment,null,"Loading..."):a,s=t.done,d=void 0===s?e.createElement(e.Fragment,null,"Done!"):s,h=t.completed,p=void 0===h?e.createElement(e.Fragment,null,"No more data"):h,m=t.doneDelay,y=void 0===m?1e3:m,g=t.lockWhileLoading,b=void 0!==g&&g,E=t.onError,S=null,x=!1,w=!1,T=null,L=null;function H(){var t=n("idle"),o=t[0],l=t[1];return r(function(){return T=l,function(){T=null}},[]),"loading"===o?e.createElement("div",{className:"ps-scrollbar-loadmore-loader"},u):"done"===o?e.createElement("div",{className:"ps-scrollbar-loadmore-done"},d):"completed"===o?e.createElement("div",{className:"ps-scrollbar-loadmore-completed"},p):null}return{mountPosition:"inside",render:function(){return e.createElement(H,null)},onInit:function(e,t){S=t},onScroll:function(){return v(this,void 0,void 0,function(){var e,t,n,r,o;return f(this,function(a){switch(a.label){case 0:if(!S||x||w)return[2];if(e=S.scrollTop,t=S.scrollHeight,n=S.clientHeight,!(l<1?e+n>=t*l:e+n>=t-l))return[2];x=!0,null==T||T("loading"),b&&(S.style.pointerEvents="none"),a.label=1;case 1:return a.trys.push([1,3,4,5]),[4,i()];case 2:return void 0===(r=a.sent())&&(r=!0),r?(null==T||T("done"),L&&clearTimeout(L),L=window.setTimeout(function(){null==T||T("idle"),L=null},y)):(w=!0,null==T||T("completed"),null==c||c()),[3,5];case 3:return o=a.sent(),null==E||E(o),null==T||T("idle"),[3,5];case 4:return b&&(S.style.pointerEvents=""),x=!1,[7];case 5:return[2]}})})},onDestroy:function(){S=null,x=!1,w=!1,T=null,L&&(clearTimeout(L),L=null)}}},N=function(t){var n=t.state,r=t.loading,o=t.done;return"loading"===n?e.createElement("div",{className:"ps-scrollbar-ptr-loader"},r):"done"===n?e.createElement("div",{className:"ps-scrollbar-ptr-done"},o):e.createElement("div",{className:"ps-scrollbar-ptr-placeholder"})},Y=function(t){var o,l=t.threshold,i=void 0===l?60:l,c=t.onRefresh,a=t.loading,u=void 0===a?e.createElement(e.Fragment,null,"ðŸ”„ Loading..."):a,s=t.done,d=void 0===s?e.createElement(e.Fragment,null,"âœ… Done!"):s,h=t.doneDuration,p=void 0===h?500:h,m=t.lockScrollWhileLoading,y=void 0===m||m,g=null,b=null,E=null,S=null,x=null,w=!1,T=!1,L=null,H=0,M=0,I="number"==typeof i?i:60,A=null,F=function(){b&&(b.style.transition="transform 0.3s",b.style.transform="translateY(0px)",setTimeout(function(){b&&(b.style.transition="")},300)),M=0,null==o||o("idle")},R=function(e,t){g&&!w&&(g.scrollTop>0||(T=!0,H=e,"number"==typeof t&&(L=t)))},k=function(e,t){if(T&&g&&b&&!w){var n=e-H;if(n<=0)M>0&&F();else{if(t&&"preventDefault"in t)try{t.preventDefault()}catch(e){}M=Math.min(.5*n,2*I),b.style.transform="translateY(".concat(M,"px)")}}},D=function(){return v(void 0,void 0,void 0,function(){return f(this,function(e){switch(e.label){case 0:if(!T||!g||!b)return T=!1,L=null,[2];if(T=!1,L=null,!(M>=I)||w)return[3,6];w=!0,y&&(x=g.style.pointerEvents||null,g.style.pointerEvents="none"),b.style.transition="transform 0.3s",b.style.transform="translateY(".concat(I,"px)"),null==o||o("loading"),e.label=1;case 1:return e.trys.push([1,3,4,5]),[4,c()];case 2:return e.sent(),null==o||o("done"),[3,5];case 3:return e.sent(),null==o||o("idle"),[3,5];case 4:return A&&clearTimeout(A),A=window.setTimeout(function(){F(),y&&g&&(g.style.pointerEvents=null!==x?x:""),w=!1,A=null},p),[7];case 5:return[3,7];case 6:F(),e.label=7;case 7:return[2]}})})},C=function(e){if(!w&&g&&!(g.scrollTop>0)){R(e.clientY,e.pointerId);try{g.setPointerCapture(e.pointerId)}catch(e){}}},q=function(e){T&&(null!=L&&e.pointerId!==L||k(e.clientY,e))},z=function(e){if(null!=L)try{null==g||g.releasePointerCapture(L)}catch(e){}D()},O=function(e){if(null!=L)try{null==g||g.releasePointerCapture(L)}catch(e){}T=!1,L=null,F()},P=function(e){!e.touches||e.touches.length>1||!g||w||g.scrollTop>0||R(e.touches[0].clientY)},j=function(e){T&&k(e.touches[0].clientY,e)},Y=function(){return D()},W=function(e){0===e.button&&(!g||w||g.scrollTop>0||(R(e.clientY),document.addEventListener("selectstart",X)))},B=function(e){T&&k(e.clientY,e)},U=function(){document.removeEventListener("selectstart",X),D()},X=function(e){return e.preventDefault()},K=function(){var t=n("idle"),l=t[0],i=t[1];return r(function(){return o=i,function(){o=void 0}},[]),e.createElement("div",{className:"ps-scrollbar-ptr",style:{position:"absolute",top:0,left:0,right:0,height:"60px",display:"flex",alignItems:"center",justifyContent:"center",zIndex:10}},e.createElement(N,{state:l,loading:u,done:d}))};return{mountPosition:"before",render:function(){return e.createElement(K,null)},onInit:function(e,t){g=t,b=t.querySelector(".ps__content")||t.firstElementChild||null;var n=window.getComputedStyle(g).position;E=g.style.position||null,["relative","absolute","fixed"].includes(n)||(g.style.position="relative"),S=g.style.overscrollBehavior||"",g.style.overscrollBehavior="contain",g.style.touchAction="pan-y",b&&(b.style.willChange="transform"),I=i<1?Math.max(30,Math.round(g.clientHeight*i)):i,g.style.setProperty("--ps-ptr-threshold","".concat(I,"px")),g.addEventListener("pointerdown",C),g.addEventListener("pointermove",q),g.addEventListener("pointerup",z),g.addEventListener("pointercancel",O),g.addEventListener("touchstart",P,{passive:!1}),g.addEventListener("touchmove",j,{passive:!1}),g.addEventListener("touchend",Y),g.addEventListener("mousedown",W),document.addEventListener("mousemove",B),document.addEventListener("mouseup",U)},onScroll:function(){!w&&g&&g.scrollTop>0&&M>0&&F()},onDestroy:function(){g&&(g.removeEventListener("pointerdown",C),g.removeEventListener("pointermove",q),g.removeEventListener("pointerup",z),g.removeEventListener("pointercancel",O),g.removeEventListener("touchstart",P),g.removeEventListener("touchmove",j),g.removeEventListener("touchend",Y),g.removeEventListener("mousedown",W),document.removeEventListener("mousemove",B),document.removeEventListener("mouseup",U),document.removeEventListener("selectstart",X),b&&(b.style.transform="",b.style.transition="",b.style.willChange=""),g&&(null!==E&&(g.style.position=E),g.style.overscrollBehavior=null!==S?S:"",g.style.removeProperty("--ps-ptr-threshold"),g.style.touchAction="",null!==x&&(g.style.pointerEvents=x),g=null),A&&(clearTimeout(A),A=null),w=!1,T=!1,L=null,H=0,M=0,o=void 0)}}},W=function(e){var t=void 0===e?{}:e,n=t.threshold,r=void 0===n?.9:n,o=t.callbacks,l=void 0===o?{}:o;return{onScroll:function(e){var t,n;e.scrollTop<=0&&(null===(t=null==l?void 0:l.onTop)||void 0===t||t.call(l)),(r<1?e.scrollTop+e.clientHeight>=e.scrollHeight*r:e.scrollTop+e.clientHeight>=e.scrollHeight-r)&&(null===(n=null==l?void 0:l.onBottom)||void 0===n||n.call(l))}}},B=function(e){var t=void 0===e?{}:e,n=t.itemSelector,r=void 0===n?"div":n,o=t.snapDelay,l=void 0===o?100:o,i=null;return{onScroll:function(e){i&&clearTimeout(i),i=window.setTimeout(function(){!function(e){var t=Array.from(e.querySelectorAll(r));if(t.length){var n=e.scrollTop,o=t.reduce(function(e,t){return Math.abs(t.offsetTop-n)<Math.abs(e.offsetTop-n)?t:e});o&&g(e,o.offsetTop,{duration:200})}}(e)},l)},onDestroy:function(){i&&clearTimeout(i)}}},U=function(e){var t=void 0===e?{}:e,n=t.leftColumns,r=void 0===n?0:n,o=t.rightColumns,l=void 0===o?0:o,i=t.zIndex,c=void 0===i?10:i,a=t.background,u=void 0===a?"#fff":a,s=null;return{onInit:function(e,t){s=t.querySelector("table"),function(){if(s){for(var e=Array.from(s.querySelectorAll("thead th")),t=Array.from(s.querySelectorAll("tbody tr")),n=e.map(function(e){return e.getBoundingClientRect().width}),o=function(r){var o=e[r],l=n.slice(0,r).reduce(function(e,t){return e+t},0);o.style.position="sticky",o.style.left=l+"px",o.style.zIndex=c.toString(),o.style.background=u,t.forEach(function(e){var t=e.children[r];t.style.position="sticky",t.style.left=l+"px",t.style.zIndex=(c-1).toString(),t.style.background=u})},i=0;i<r;i++)o(i);var a=function(r){var o=e.length-1-r,l=e[o],i=n.slice(o+1).reduce(function(e,t){return e+t},0);l.style.position="sticky",l.style.right=i+"px",l.style.zIndex=c.toString(),l.style.background=u,t.forEach(function(e){var t=e.children[o];t.style.position="sticky",t.style.right=i+"px",t.style.zIndex=(c-1).toString(),t.style.background=u})};for(i=0;i<l;i++)a(i)}}()},onDestroy:function(){s&&(Array.from(s.querySelectorAll("th, td")).forEach(function(e){e.style.position="",e.style.left="",e.style.right="",e.style.zIndex="",e.style.background=""}),s=null)}}},X=function(e){var t=void 0===e?{}:e,n=t.zIndex,r=void 0===n?10:n,o=t.background,l=void 0===o?"#fff":o,i=null;return{onInit:function(e,t){(i=t.querySelector("thead"))&&(i.style.position="sticky",i.style.top="0",i.style.zIndex=r.toString(),i.style.background=l)},onDestroy:function(){i&&(i.style.position="",i.style.top="",i.style.zIndex="",i.style.background=""),i=null}}};function K(e){var r=e.itemCount,o=e.itemSize,l=e.estimateItemHeight,a=void 0===l?50:l,u=e.overscan,s=void 0===u?2:u,d=t(new Map),v=n(0),f=v[0],h=v[1],p=i(function(e,t){d.current.get(e)!==t&&(d.current.set(e,t),h(function(e){return e+1}))},[]),m=i(function(){if(o)return r*o;var e=0,t=0;d.current.forEach(function(n){e+=n,t++});var n=Math.max(0,r-t);return e+n*a},[r,o,a,f]),y=c(function(){if(o)return null;for(var e=new Array(r+1).fill(0),t=0;t<r;t++){var n=d.current.get(t);e[t+1]=e[t]+(void 0!==n?n:a)}return e},[r,a,f]),g=i(function(e){if(o)return Math.floor(e/o);for(var t=y,n=0,l=r;n<l;){var i=n+l>>1;t[i]<=e?n=i+1:l=i}return Math.max(0,n-1)},[o,y,r]),b=i(function(e){return e<=0?0:o?e*o:y?y[Math.min(e,y.length-1)]:e*a},[o,y,a]),E=i(function(e,t){var n=Math.max(0,g(e)-s),l=Math.ceil(t/(null!=o?o:a));return{startIndex:n,endIndex:Math.min(r-1,n+l+2*s),offsetTop:b(n),totalHeight:m()}},[g,b,m,r,o,a,s]),S=i(function(e,t,n){var r;m();var l=b(e),i=null!=o?o:null!==(r=d.current.get(e))&&void 0!==r?r:a;return"start"===t?l:"end"===t?l-n+i:"center"===t?l-n/2+i/2:l},[m,b,o,a]);return{setSize:p,getWindowForScroll:E,getTotalHeight:m,getScrollTopForIndex:S,sizeMap:d.current}}var _=o(function(o,c){var u=o.itemCount,s=o.renderItem,v=o.itemSize,f=o.estimateItemHeight,h=void 0===f?50:f,p=o.scrollElement,m=o.height,y=o.width,g=void 0===y?"100%":y,b=o.overscan,E=void 0===b?2:b,S=o.className,x=o.style,w=o.onItemsRendered,T=t(null),L=t(null),H=n(0),M=H[0],I=H[1],A=t(null),F=K({itemCount:u,itemSize:v,estimateItemHeight:h,overscan:E}),R=F.setSize,k=F.getWindowForScroll,D=F.getTotalHeight,C=F.getScrollTopForIndex;a(function(){var e,t,n,r,o=function(e){var t;return e?"function"==typeof e.addEventListener?e:null!==(t=e.current)&&void 0!==t?t:null:null}(p);if(o||(o=null!==(e=function(e){if(!e)return null;for(var t=e.parentElement;t;){var n=window.getComputedStyle(t).overflowY;if(/(auto|scroll|overlay)/.test(n)&&t.scrollHeight>t.clientHeight)return t;t=t.parentElement}return null}(T.current))&&void 0!==e?e:null),!o&&T.current){var l=T.current;l.scrollHeight>l.clientHeight&&(o=l)}A.current=o,I(null!==(r=null!==(t=null==o?void 0:o.scrollTop)&&void 0!==t?t:null===(n=T.current)||void 0===n?void 0:n.scrollTop)&&void 0!==r?r:0)},[p,T.current,u]),r(function(){var e,t=null!==(e=A.current)&&void 0!==e?e:T.current;if(t){var n=function(){I(t.scrollTop)};return t.addEventListener("scroll",n,{passive:!0}),I(t.scrollTop),function(){t.removeEventListener("scroll",n)}}},[A.current]);var q=i(function(){var e,t,n=A.current;return n?n.clientHeight:null!=m?m:null!==(t=null===(e=T.current)||void 0===e?void 0:e.clientHeight)&&void 0!==t?t:0},[m]),z=k(M,q()),O=z.startIndex,P=z.endIndex,j=z.offsetTop,N=z.totalHeight;r(function(){null==w||w({startIndex:O,endIndex:P})},[O,P,w]),a(function(){var e,t=null!==(e=A.current)&&void 0!==e?e:T.current;if(t&&L.current){var n=new ResizeObserver(function(){I(t.scrollTop)});return n.observe(t),n.observe(L.current),function(){return n.disconnect()}}},[A.current]);var Y=i(function(e){return function(t){if(t){var n=t.offsetHeight;R(e,n)}}},[R]);l(c,function(){return{scrollToIndex:function(e,t,n){var r;void 0===t&&(t="start"),void 0===n&&(n="auto");var o=null!==(r=A.current)&&void 0!==r?r:T.current;if(o){var l=C(e,t,q()),i=Math.max(0,Math.min(l,D()-q()));if("scrollTo"in o)try{o.scrollTo({top:i,behavior:n})}catch(e){o.scrollTop=i}else o.scrollTop=i}},getTotalHeight:function(){return D()}}},[C,D,q]);for(var W=[],B=O;B<=P;B++){var U=e.createElement("div",{key:B,"data-virtual-index":B,ref:v?void 0:Y(B),style:{boxSizing:"border-box",width:"100%"}},s(B));W.push(U)}var X=P-O+1,_={height:j},G={height:Math.max(0,N-j-X*(null!=v?v:h))},J=!!A.current&&A.current!==T.current;return e.createElement("div",{ref:T,className:S,style:d({position:"relative",overflow:J?"visible":"auto",height:J?void 0:m,width:g,willChange:"transform"},x)},e.createElement("div",{ref:L,style:{position:"relative",height:N}},e.createElement("div",{style:_}),e.createElement("div",null,W),e.createElement("div",{style:G})))});export{N as PullToRefresh,_ as VirtualizedList,g as animateScrollTo,E as animateScrollToBottom,S as animateScrollToTop,b as animateScrollToX,L as appendDimension,H as appendEventListener,C as bounceEffectPlugin,q as bounceHighlightPlugin,F as calculatorRealSize,x as callPlugins,M as clearEventListener,w as createScrollbarApi,D as default,R as find1stLevel,I as findTargetTable,z as gradientIndicatorPlugin,O as highlightItemPlugin,P as inertiaPlugin,j as loadMorePlugin,A as psHtmlListSize,Y as pullToRefreshPlugin,W as scrollSpyPlugin,B as snapToItemPlugin,h as startMomentumScroll,U as stickyColumnsPlugin,X as stickyHeaderPlugin,k as useScrollbarCore,K as useVirtual};
